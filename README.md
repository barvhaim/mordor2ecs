# mordor2ecs
Raw Mordor's Windows Log to ECS format

Input: mordor large dataset after extraction, for example,
`mordor-master/datasets/large/apt29/day1/apt29_evals_day1_manual_2020-05-01225525.json`

Output: converted events to winlogbeat 7.8 ECS 1.5 format
```
{"@metadata": {"beat": "winlogbeat", "type": "doc", "version": "7.8.0", "topic": "winlogbeat"}, "@timestamp": "2020-05-02T02:55:23.551Z", "host": {"name": "wec.internal.cloudapp.net", "hostname": "UTICA.dmevals.local"}, "computer_name": "UTICA.dmevals.local", "event": {"id": 10, "code": 10, "created": "2020-05-01T22:55Z", "dataset": "mordor", "provider": "Microsoft-Windows-Sysmon/Operational", "type": "info"}, "user": {"type": "User", "name": "SYSTEM", "identifier": "S-1-5-18", "domain": "NT AUTHORITY"}, "event_data": {"EventTime": "2020-05-01 22:55:23", "port": 60737, "Message": "Process accessed:\r\nRuleName: -\r\nUtcTime: 2020-05-02 02:55:23.551\r\nSourceProcessGUID: {6bbf237a-cafb-5eac-1000-000000000400}\r\nSourceProcessId: 900\r\nSourceThreadId: 504\r\nSourceImage: C:\\windows\\system32\\svchost.exe\r\nTargetProcessGUID: {6bbf237a-cb97-5eac-6202-000000000400}\r\nTargetProcessId: 2092\r\nTargetImage: C:\\windows\\System32\\svchost.exe\r\nGrantedAccess: 0x1000\r\nCallTrace: C:\\windows\\SYSTEM32\\ntdll.dll+9c584|C:\\windows\\SYSTEM32\\psmserviceexthost.dll+222a3|C:\\windows\\SYSTEM32\\psmserviceexthost.dll+1a172|C:\\windows\\SYSTEM32\\psmserviceexthost.dll+19e3b|C:\\windows\\SYSTEM32\\psmserviceexthost.dll+19318|C:\\windows\\SYSTEM32\\ntdll.dll+3089d|C:\\windows\\SYSTEM32\\ntdll.dll+34634|C:\\windows\\System32\\KERNEL32.DLL+17bd4|C:\\windows\\SYSTEM32\\ntdll.dll+6ced1", "TargetProcessId": "2092", "SourceModuleName": "eventlog", "tags": ["mordorDataset"], "@version": "1", "SourceName": "Microsoft-Windows-Sysmon", "TargetImage": "C:\\windows\\System32\\svchost.exe", "host": "wec.internal.cloudapp.net", "Task": 10, "ThreadID": 4396, "EventReceivedTime": "2020-05-01 22:55:26", "CallTrace": "C:\\windows\\SYSTEM32\\ntdll.dll+9c584|C:\\windows\\SYSTEM32\\psmserviceexthost.dll+222a3|C:\\windows\\SYSTEM32\\psmserviceexthost.dll+1a172|C:\\windows\\SYSTEM32\\psmserviceexthost.dll+19e3b|C:\\windows\\SYSTEM32\\psmserviceexthost.dll+19318|C:\\windows\\SYSTEM32\\ntdll.dll+3089d|C:\\windows\\SYSTEM32\\ntdll.dll+34634|C:\\windows\\System32\\KERNEL32.DLL+17bd4|C:\\windows\\SYSTEM32\\ntdll.dll+6ced1", "Keywords": -9223372036854775808, "RecordNumber": 138294, "SourceModuleType": "im_msvistalog", "@timestamp": "2020-05-02T02:55:26.493Z", "SeverityValue": 2, "Version": 3, "OpcodeValue": 0, "Severity": "INFO", "Channel": "Microsoft-Windows-Sysmon/Operational", "GrantedAccess": "0x1000", "SourceProcessGUID": "{6bbf237a-cafb-5eac-1000-000000000400}", "EventType": "INFO", "TargetProcessGUID": "{6bbf237a-cb97-5eac-6202-000000000400}", "ExecutionProcessID": 3496, "ProviderGuid": "{5770385F-C22A-43E0-BF4C-06F5698FFBD9}"}, "process": {"thread": {"id": "504"}, "executable": "C:\\windows\\system32\\svchost.exe", "pid": "900", "name": "svchost.exe"}, "rule": {"name": "-"}}

{"@metadata": {"beat": "winlogbeat", "type": "doc", "version": "7.8.0", "topic": "winlogbeat"}, "@timestamp": "2020-05-02T03:04:58.508Z", "host": {"name": "wec.internal.cloudapp.net", "hostname": "SCRANTON.dmevals.local"}, "computer_name": "SCRANTON.dmevals.local", "event": {"id": 4103, "code": 4103, "created": "2020-05-01T23:04Z", "dataset": "mordor", "provider": "Microsoft-Windows-PowerShell", "type": "info", "category": "process", "sequence": "4105"}, "user": {"type": "User", "name": "pbeesly", "identifier": "S-1-5-21-1830255721-3727074217-2423397540-1107", "domain": "DMEVALS"}, "event_data": {"EventTime": "2020-05-01 23:04:57", "port": 60737, "Message": "CommandInvocation(Out-Default): \"Out-Default\"\r\nParameterBinding(Out-Default): name=\"InputObject\"; value=\"C:\\Users\\pbeesly\\Downloads\\coyn5igj.3io.pfx\"\r\n\r\n\r\nContext:\r\n        Severity = Informational\r\n        Host Name = ConsoleHost\r\n        Host Version = 5.1.18362.628\r\n        Host ID = a1219642-d065-4cde-8f58-8d87d685e4b7\r\n        Host Application = powershell.exe\r\n        Engine Version = 5.1.18362.628\r\n        Runspace ID = 4a7c8f4b-0979-4419-b365-f34273747df5\r\n        Pipeline ID = 59\r\n        Command Name = \r\n        Command Type = Script\r\n        Script Name = \r\n        Command Path = \r\n        Sequence Number = 4105\r\n        User = DMEVALS\\pbeesly\r\n        Connected User = \r\n        Shell ID = Microsoft.PowerShell\r\n\r\n\r\nUser Data:\r\n\r\n", "Opcode": "To be used when operation is just executing a method", "Payload": "CommandInvocation(Out-Default): \"Out-Default\"\r\nParameterBinding(Out-Default): name=\"InputObject\"; value=\"C:\\Users\\pbeesly\\Downloads\\coyn5igj.3io.pfx\"\r\n", "SourceModuleName": "eventlog", "tags": ["mordorDataset"], "@version": "1", "SourceName": "Microsoft-Windows-PowerShell", "host": "wec.internal.cloudapp.net", "Task": 106, "ThreadID": 5584, "EventReceivedTime": "2020-05-01 23:04:58", "ContextInfo": "        Severity = Informational\r\n        Host Name = ConsoleHost\r\n        Host Version = 5.1.18362.628\r\n        Host ID = a1219642-d065-4cde-8f58-8d87d685e4b7\r\n        Host Application = powershell.exe\r\n        Engine Version = 5.1.18362.628\r\n        Runspace ID = 4a7c8f4b-0979-4419-b365-f34273747df5\r\n        Pipeline ID = 59\r\n        Command Name = \r\n        Command Type = Script\r\n        Script Name = \r\n        Command Path = \r\n        Sequence Number = 4105\r\n        User = DMEVALS\\pbeesly\r\n        Connected User = \r\n        Shell ID = Microsoft.PowerShell\r\n", "ActivityID": "{BCCD0404-4290-0001-CF70-13D71F20D601}", "Category": "Executing Pipeline", "Keywords": 0, "RecordNumber": 10588, "SourceModuleType": "im_msvistalog", "@timestamp": "2020-05-02T03:04:58.508Z", "SeverityValue": 2, "Version": 1, "OpcodeValue": 20, "Severity": "Informational", "Channel": "Microsoft-Windows-PowerShell/Operational", "EventType": "INFO", "ExecutionProcessID": 3876, "ProviderGuid": "{A0C1853B-5C40-4B15-8766-3CF1C58F985A}", "HostID": "a1219642-d065-4cde-8f58-8d87d685e4b7", "RunspaceID": "4a7c8f4b-0979-4419-b365-f34273747df5", "PipelineID": "59"}, "process": {"title": "ConsoleHost", "command_line": "powershell.exe", "args": []}, "powershell": {"id": "Microsoft.PowerShell", "engine": {"version": "5.1.18362.628"}, "process": {"executable_version": "5.1.18362.628"}, "command": {"type": "Script"}}}
```

